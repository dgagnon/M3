#!/bin/bash
# Use reload instead.  makes sure everything is stopped.
. /var/www/html/m4/.env

if [[ "$ENVIRONEMENT" = 'prod' ]];then
	alias pip=pip3
	alias easy_install=easy_install3
	alias python=python3
	export LC_ALL=en_US.UTF-8
	export LANG=en_US.UTF-8
	export LANGUAGE=en_US.UTF-8
	export DJANGO_SETTINGS_MODULE=M4.settings
  export PATH=$PATH:/var/www/html/m4/bin
  export ENV=prod
	TZ='America/Toronto'; export TZ
	cd /var/www/html/m4/
	/usr/local/bin/uwsgi --module=wsgi:application --master --pidfile=/var/www/html/m4/master.pid --socket=127.0.0.1:49152 --processes=8 --enable-threads --harakiri=18000 --daemonize=/var/www/html/m4/logs/uwsi-boot.log
	C_FORCE_ROOT=1 celery -A M4 worker --beat --scheduler django --loglevel=info -E --detach --logfile /var/www/html/m4/logs/worker.log --pidfile /var/www/html/m4/celery.pid
fi
